from fastapi import FastAPI, HTTPException, UploadFile, File, Form
from pdf2image import convert_from_path
import boto3
from botocore.exceptions import NoCredentialsError, ClientError
import os
import io
import openai
import asyncio
import fitz 
import nltk
from nltk.tokenize import sent_tokenize
from sqlalchemy import create_engine, MetaData, Table, Column, String, Integer, ForeignKey, Float
from sqlalchemy.dialects.postgresql import ARRAY
from starlette.status import HTTP_500_INTERNAL_SERVER_ERROR
from sqlalchemy.orm import sessionmaker
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.sql import text
from dotenv import load_dotenv
from sqlalchemy import insert


# Load environment variables
load_dotenv()


vectorData =  {
        "sourcebookHash": '5b969f606dda9f4f8a790cd2ff727861',
        "vector": """[-0.0022564250975847244, -0.004144175443798304, 0.010083933360874653, -0.023404009640216827, 0.007981122471392155, 0.010814455337822437, -0.034600794315338135, -0.039188746362924576, -0.010022487491369247, -0.011415258049964905, -0.009872286580502987, 0.025752604007720947, -0.007626102305948734, 0.01517027709633112, 0.013859434053301811, 0.015716461464762688, 0.022639350965619087, 0.0030808225274086, -0.003225902793928981, -0.038424085825681686, -0.0027070273645222187, -0.011777105741202831, -0.00471084238961339, -0.01214578002691269, 0.0012203812366351485, 0.009291965514421463, 0.012466663494706154, -0.006561042740941048, -0.017710035666823387, 0.014719675295054913, 0.024810435250401497, 0.013204012997448444, 0.015743771567940712, -0.0030791156459599733, -0.013995980843901634, -0.004447991028428078, 0.015866663306951523, -0.00798794999718666, 0.0030466860625892878, -0.012391563504934311, 0.02564336732029915, 0.002833332633599639, -0.002572188153862953, 0.013838952407240868, -0.006400601007044315, 0.0005188753711991012, -0.010548190213739872, -0.024687543511390686, 0.011101202107965946, -0.007011645007878542, 0.030613647773861885, 0.007899194955825806, -0.03738633543252945, 0.023048989474773407, -0.01537509635090828, -0.01534778717905283, -0.01308794878423214, 0.008936945348978043, 0.0266401544213295, -0.02601204253733158, -0.023526901379227638, 0.0020976902451366186, -0.0033795172348618507, 0.0025551198050379753, -0.0048303199000656605, 0.0008346383692696691, -0.0022171682212501764, -0.010036141611635685, -0.03632127493619919, -0.00676586152985692, 0.009906423278152943, -8.571470971219242e-05, 0.004553813952952623, -0.005813452415168285, 0.022748589515686035, -0.0010292165679857135, -0.008998391218483448, -0.017355015501379967, 0.01109437458217144, 7.035327143967152e-05, 0.02441445179283619, -0.01649477519094944, -0.021082725375890732, 0.020823288708925247, 0.006704416126012802, -0.021847384050488472, 0.017300397157669067, 4.909794370178133e-05, -0.018884332850575447, 0.0005871484754607081, -0.0020823287777602673, 0.011661041527986526, 0.015429714694619179, 0.010630117729306221, -0.0016701300628483295, 0.019881119951605797, -0.010520881041884422, 0.031214449554681778, -0.02864738181233406, -0.01547067891806364, -0.01440561842173338, -0.0032190755009651184, -0.01265100110322237, -0.01170883234590292, -0.030477100983262062, -0.024550998583436012, 0.0061752996407449245, 0.005868070758879185, 0.027541358023881912, -0.023144572973251343, -0.02112368866801262, 0.018652204424142838, 0.014924494549632072, -0.03582971170544624, 0.00037912893458269536, -0.01697268709540367, -1.136773335019825e-05, -0.019212042912840843, 0.018570275977253914, -0.02829236164689064, 0.02740481309592724, 0.023581519722938538, 0.022338951006531715, 0.026967864483594894, 0.030886739492416382, -0.015866663306951523, -0.01953975483775139, 0.0017298690509051085, -0.0005944024887867272, -0.009585539810359478, 0.008766262792050838, 0.015607224777340889, 0.023554211482405663, -0.0007616715156473219, -0.00965381320565939, 0.028893165290355682, -0.004072488751262426, 0.002585842739790678, -0.008554616011679173, -0.0017699794843792915, 0.00927148386836052, 0.033726900815963745, -0.01978553645312786, -0.018051400780677795, -0.011019274592399597, 0.036130111664533615, 0.018065055832266808, -0.007093572523444891, 0.015771079808473587, -0.0024714854080229998, -0.0025363448075950146, 0.020208830013871193, -0.0074281105771660805, -0.020563850179314613, -0.003306123660877347, -0.006318673025816679, -0.029493968933820724, 0.016467465087771416, -0.005065862089395523, -0.024810435250401497, 0.03195179998874664, 0.0032020071521401405, 0.0045606414787471294, -0.0098313232883811, 0.005093171261250973, 0.020768670365214348, 0.008588752709329128, 0.00603192625567317, -0.002394678071141243, 0.0019594372715801, 0.005663251504302025, 0.01925300806760788, -0.02371806651353836, 0.039598383009433746, -0.023759029805660248, 0.04085460677742958, -0.00046895068953745067, -0.02441445179283619, -0.006817066576331854, -0.015893971547484398, 0.035720471292734146, -0.019635336473584175, 0.016918068751692772, 0.034245774149894714, -0.027268266305327415, 0.017942164093255997, 0.014132526703178883, -0.015511643141508102, -0.012965057045221329, 0.009373893029987812, 0.002152308588847518, 0.004625500645488501, -0.01973091810941696, -0.007933331653475761, -0.6318263411521912, 0.005571083165705204, -0.02418232336640358, -0.03320802375674248, -0.01953975483775139, -0.005943171214312315, 0.006001203320920467, -0.00040025089401751757, -0.03328995034098625, -0.005728111136704683, 0.013661442324519157, 0.0036662642378360033, 0.004891765769571066, -0.01050722599029541, -0.012248190119862556, -0.021874694153666496, 0.008882327005267143, -0.011899996548891068, -0.02553413063287735, -0.010555017739534378, -0.009838149882853031, 0.003744778223335743, -0.0061070267111063, -0.012084334157407284, -0.0015506522031500936, -0.0185566209256649, -0.014432928524911404, -0.0052126492373645306, 0.008199596777558327, -0.01447389181703329, -0.02523372881114483, 0.026544570922851562, 0.004185139667242765, 0.005717869848012924, 0.039707619696855545, -0.00944899395108223, -0.006404014304280281, 0.019976701587438583, 0.0016871984116733074, 0.03222488984465599, -0.018338147550821304, 0.0027496980037540197, -0.009148592129349709, 0.0005619727307930589, -0.01795581914484501, -0.011934133246541023, 0.01440561842173338, -0.0022274090442806482, -0.003277107607573271, -0.014569474384188652, 
0.00170597352553159, 0.008418070152401924, 0.02524738386273384, -0.007516865618526936, 0.0019594372715801, 0.010077105835080147, 0.010636945255100727, 0.033262643963098526, 0.0009814254008233547, 0.013374695554375648, 0.004990761633962393, 0.026257824152708054, -0.03421846404671669, -0.01843373104929924, -0.013606823980808258, -0.022612042725086212, -0.012794374488294125, -0.01144939474761486, 0.01076666358858347, -0.006509837694466114, -0.016481120139360428, 0.018925296142697334, -0.014432928524911404, 0.00402128417044878, -0.0029528106097131968, 0.0027701801154762506, -0.006011444143950939, -0.024318870157003403, -0.004219275899231434, 0.02699517458677292, 0.002309336792677641, -0.01943051628768444, -0.028674691915512085, -0.00839758850634098, 0.0009105921490117908, 0.0042738947086036205, -0.0037174690514802933, -0.01919838786125183, 0.008445379324257374, 0.023922884836792946, -0.005198994651436806, 0.022038549184799194, -0.008930117823183537, -0.026913246139883995, -0.009435338899493217, -0.014036944136023521, -0.007120881695300341, 0.017573488876223564, -0.021861039102077484, 0.00041283873724751174, -0.028838546946644783, -0.010698391124606133, 0.00242028059437871, -0.0313509963452816, 0.015006422065198421, -0.001497740624472499, -0.04533332213759422, 0.00179387500975281, 0.04424095153808594, -0.021110035479068756, -0.005857829935848713, -0.002304216381162405, 0.012302808463573456, 0.011306021362543106, 0.005028312094509602, -0.02429156005382538, 0.032252199947834015, 0.013866261579096317, 0.016412846744060516, -0.01519758626818657, 0.029848989099264145, 0.002520983340218663, 0.039598383009433746, -0.024100394919514656, -0.020031319931149483, 0.00812449585646391, 0.02031806670129299, -0.00447871396318078, 0.009298793040215969, -0.024810435250401497, 0.04459597170352936, 0.011230920441448689, 0.013388349674642086, -0.018979914486408234, 0.0176690723747015, 0.03318071365356445, 0.02293975278735161, -0.0011981924762949347, 0.03435501083731651, -0.03662167862057686, -0.0059022074565291405, 0.00567690609022975, 0.00010091614240081981, -0.02401846833527088, -0.006769275292754173, -0.027459431439638138, -0.01262369193136692, -0.003353914711624384, -0.019444171339273453, -0.017942164093255997, -0.0030739952344447374, -0.008056222461163998, -0.00717550003901124, 0.002150601940229535, -0.0027616459410637617, -0.009974696673452854, -0.013545378111302853, -0.021574292331933975, -0.0352289080619812, -0.019171079620718956, -0.0029528106097131968, 0.011046583764255047, -0.03580240160226822, 0.02318553626537323, -0.018570275977253914, -0.022625697776675224, -0.025957422330975533, 0.015921281650662422, -0.01743694394826889, -0.022038549184799194, 0.01461043767631054, -0.00707309041172266, -0.004512850195169449, 0.02078232355415821, -0.005632528569549322, 0.03268914669752121, -0.0021864452864974737, 0.010261443443596363, -0.019389552995562553, -0.0069433716125786304, -0.0033641557674854994, 0.008226905949413776, 0.012671482749283314, 0.01825622096657753, 0.024796780198812485, 0.025370275601744652, 0.014228109270334244, -0.028019269928336143, -0.01994939334690571, 0.05887870118021965, -0.009749394841492176, 0.027281921356916428, -0.00025239703245460987, 0.000498393434099853, 
-0.017177505418658257, 0.023349391296505928, -0.024100394919514656, 0.023158228024840355, 0.02183372899889946, 
0.023158228024840355, -0.0009421684662811458, -0.005287749692797661, 0.019225697964429855, -0.011306021362543106, 0.01488353032618761, -0.033836137503385544, 0.005745179485529661, -0.024455415084958076, 0.033426497131586075, 0.022216059267520905, 0.004686946514993906, -0.005403813906013966, -0.01519758626818657, -0.011852205730974674, 0.01683614030480385, 0.02330842800438404, 0.030613647773861885, 0.005414054729044437, 0.024455415084958076, 0.0008329315460287035, 0.025616057217121124, -0.005915862042456865, 0.04653492942452431, 0.008499997667968273, -0.005840761587023735, 0.008964254520833492, -0.008226905949413776, 0.015388751402497292, -0.020973488688468933, -0.020768670365214348, 0.013982325792312622, 0.003425601636990905, 0.018925296142697334, 0.006025098729878664, 0.04344898462295532, 0.006987749133259058, 0.006072890013456345, -0.0020925698336213827, 0.028019269928336143, 0.01537509635090828, 0.013695579022169113, 0.007714857347309589, 0.026380715891718864, -0.026694772765040398, 0.012364254333078861, 0.0015079815639182925, -0.007489556446671486, 0.015702806413173676, 0.013299594633281231, 0.0018484934698790312, -0.01467871107161045, 0.031023286283016205, -0.03790521249175072, -0.0073803192935884, 0.013524896465241909, -0.008971082046627998, 0.03034055419266224, 0.010520881041884422, 0.004847388248890638, 0.0294666588306427, -0.00022743467707186937, 0.02318553626537323, 0.00968794897198677, 0.00014657375868409872, 0.02500160038471222, 0.03866986930370331, 0.0019372485112398863, -0.002355421194806695, -0.005014657508581877, 0.0027548186480998993, -0.014241763390600681, 0.00830200593918562, 0.0010676202364265919, -0.014815256930887699, 0.016412846744060516, 0.0008209837251342833, -0.012084334157407284, 0.004946384113281965, 0.006806825753301382, 0.020277103409171104, -0.016522083431482315, -0.026612844318151474, 0.011142166331410408, 0.01557991560548544, -4.0830498619470745e-05, -0.009469475597143173, -0.013750197365880013, -0.014774293638765812, -0.006731725297868252, 0.011544977314770222, -0.018420075997710228, 0.028920475393533707, 0.03774135559797287, -0.0006477407878264785, -0.014200800098478794, -0.020263448357582092, 0.012780719436705112, -0.01994939334690571, -0.0001507341512478888, 0.005772488657385111, 0.007127709221094847, -0.0056495969183743, 0.0003033884859178215, 0.018570275977253914, 0.011217266321182251, -0.00011969123443122953, -0.024387141689658165, -0.020741360262036324, -0.004413854330778122, -0.01973091810941696, 0.018979914486408234, -0.021697184070944786, -0.014214454218745232, 0.009428511373698711, 0.03558392822742462, -0.0044309226796031, -0.0069433716125786304, -0.009237347170710564, 0.026517262682318687, 0.02172449231147766, -0.012739756144583225, 0.0010812748223543167, -0.03678553178906441, -0.00989276822656393, 0.06614295393228531, 0.0014695778954774141, -0.009578712284564972, -0.01473332941532135, -0.019007224589586258, -0.046999186277389526, -0.018065055832266808, -0.0122140534222126, 0.02366344816982746, 0.003229316556826234, 0.010090760886669159, 0.01455581933259964, 0.005236544646322727, -0.020768670365214348, 0.0015284634428098798, -0.012336944229900837, -0.0020413650199770927, -0.004680119454860687, -0.0030432722996920347, -0.05044014751911163, 0.02706344611942768, -0.0028862443286925554, 0.030832121148705482, 0.02247549593448639, 0.0003319778188597411, -0.007551002316176891, 0.018638549372553825, -0.00011702431947924197, -0.006038753315806389, -0.020809633657336235, 0.009080318734049797, 0.005151203367859125, 0.006421082653105259, 0.024496380239725113, -0.00547208683565259, -0.0185566209256649, 0.004591364413499832, -0.003454617690294981, 0.009025700390338898, -0.0157847348600626, 0.014269072562456131, 0.004529918543994427, 0.007359837647527456, 0.0013082828372716904, -0.0024134533014148474, -0.019580718129873276, -0.005936343688517809, 0.001814357005059719, 0.00038808977114968, 0.0008120228885672987, 0.004526504781097174, -0.0032617461401969194, -0.02336304634809494, 0.003761846339330077, 0.023636138066649437, 0.00190823245793581, 0.012398390099406242, -0.0030364450067281723, -0.021287545561790466, 0.002435642061755061, -0.019498789682984352, 2.9736123906332068e-05, 0.020099593326449394, 0.006328913848847151, -0.0351196713745594, -0.02770521305501461, -0.009838149882853031, 0.015934934839606285, -0.04049958661198616, 0.02624417096376419, -0.02560240402817726, -0.014460237696766853, -0.018106019124388695, -0.0021352404728531837, 0.011988751590251923, -0.011715659871697426, 0.03457348421216011, 0.022994371131062508, -0.0018228910630568862, 0.01644015684723854, 0.0071413638070225716, -0.012644173577427864, -0.01907549798488617, -0.0315694697201252, 0.0078923674300313, -0.004038352519273758, -0.0014883530093356967, 0.015566261485219002, -0.011346984654664993, -0.009346583858132362, -0.023690756410360336, -0.02014055661857128, 0.03826023265719414, -0.02530200220644474, 0.012971884571015835, 0.025288347154855728, 0.02759597636759281, 0.010875901207327843, 0.010459435172379017, 0.00399397499859333, -0.022106822580099106, -0.02095983363687992, -0.01613975502550602, -0.00447871396318078, -0.00824738759547472, -0.010418470948934555, 0.014419273473322392, 0.02149236388504505, -0.016713248565793037, -0.009373893029987812, 0.00463574193418026, -0.012698791921138763, 0.022147785872220993, -0.00194748945068568, -0.001976505620405078, 0.026694772765040398, 0.014828911982476711, 0.0007723391754552722, -0.010466262698173523, -0.01183172408491373, -0.020454613491892815, -0.03405461087822914, 0.021055417135357857, 0.025206418707966805, -0.025738948956131935, 0.01590762659907341, 0.000785993761382997, -0.019744573161005974, -0.001472138217650354, 0.004874697420746088, -0.010234134271740913, 0.012541763484477997, -0.014269072562456131, -0.0028742963913828135, -0.03804175928235054, -0.02119196206331253, -0.001788754598237574, -0.008950600400567055, -0.0009959334274753928, -0.012077506631612778, -0.022584732621908188, 0.0065473876893520355, -0.0036184729542583227, 0.007421283051371574, 0.025957422330975533, -0.02605300582945347, -0.016767866909503937, 0.03421846404671669, 
0.01526585966348648, 0.0025278106331825256, 0.004041766282171011, -0.010582326911389828, -0.04648030921816826, 
-0.008718471974134445, -0.01683614030480385, -0.017641762271523476, 0.024851398542523384, -0.004174898378551006, 0.0014337345492094755, 0.029275495558977127, 0.029739752411842346, -0.011742969043552876, 0.00027010534540750086, 0.019266661256551743, -0.008138150908052921, 0.009592367336153984, 0.007264255080372095, -0.018269874155521393, -0.0274184662848711, 0.006660038605332375, 0.0157301165163517, 0.026626499369740486, 0.004717669449746609, -0.02418232336640358, 0.03651244193315506, 0.0531710721552372, 0.0026728908997029066, 0.020208830013871193, -0.005099998787045479, -0.027568668127059937, 0.0014499494573101401, -0.0026216860860586166, -0.016863450407981873, -0.0038779107853770256, -0.026503607630729675, -0.007742166519165039, 0.050576694309711456, 0.001224648323841393, 0.0019406621577218175, -0.031023286283016205, 0.026899591088294983, -0.003237850498408079, 0.019512444734573364, -0.0019884533248841763, 0.02859276346862316, -0.013333731330931187, 0.0022342363372445107, -0.04585219547152519, 0.008663853630423546, -0.02348593808710575, 0.0023110436741262674, 0.007387146819382906, 0.002253011567518115, 0.013251803815364838, -0.01265100110322237, -0.017450597137212753, -0.019280316308140755, -0.004919074941426516, 0.00676586152985692, -0.025971077382564545, -0.039243362843990326, -0.009387548081576824, 0.0014994473895058036, -0.014569474384188652, 0.04339436814188957, 0.002497087698429823, 0.0008256774744950235, 0.03749557211995125, -0.011394776403903961, -0.0008738953620195389, 0.03520159795880318, -0.031187141314148903, 0.0625927522778511, 0.005325299687683582, 0.0011179716093465686, 0.023089954629540443, 0.01224136259406805, 0.01743694394826889, 0.007605620659887791, -6.112573464633897e-05, -0.01549798808991909, 0.02101445198059082, 0.008820881135761738, 0.006356223486363888, 0.01725943386554718, -0.012261844240128994, -0.00363895483314991, -0.029712442308664322, -0.03288031369447708, 0.03181525319814682, 0.011599595658481121, 0.007312046363949776, -0.029794370755553246, -0.006858030334115028, -0.012664655223488808, -0.006305018439888954, 0.005400400143116713, 0.002437348710373044, 0.024496380239725113, -0.015484333038330078, -0.0294666588306427, 0.03058633767068386, -0.0008307980024255812, 0.029193567112088203, 0.002811143873259425, -0.0026865454856306314, -0.004004215821623802, -0.003034738125279546, -0.036894768476486206, -0.010582326911389828, -0.0020635537803173065, 0.061008818447589874, 0.013251803815364838, -0.006482528522610664, 0.012480318546295166, -0.01150401309132576, -0.0031968867406249046, -0.026858627796173096, 0.021396782249212265, 0.030886739492416382, -0.004929316230118275, 0.013545378111302853, 
-0.0030825294088572264, 0.00992007739841938, -0.019389552995562553, -0.010746181942522526, -0.01508834958076477, 0.0033692761790007353, -0.0020857425406575203, 0.013101602904498577, 0.020263448357582092, -0.020741360262036324, -0.02993091568350792, -0.00353654520586133, -0.00473815156146884, -0.006806825753301382, 0.01183172408491373, 0.008240560069680214, 0.024974290281534195, -0.05412689223885536, -0.0158393532037735, -0.00947630312293768, -0.030040152370929718, 0.014050599187612534, -0.005775901954621077, 0.017450597137212753, 0.008752608671784401, 0.02505621872842312, -0.012302808463573456, -0.013852606527507305, -0.005895379930734634, 0.0021540154702961445, -0.03165139630436897, 0.015443369746208191, 0.010213651694357395, -0.006701002363115549, 0.008261041715741158, -0.0008790158317424357, -0.041537340730428696, -0.034081920981407166, -0.0027667663525789976, 0.005629115272313356, 0.002437348710373044, -0.01984015479683876, 0.020085938274860382, 0.02558874897658825, 0.009100801311433315, 0.02283051609992981, -0.01802409254014492, 0.006482528522610664, 0.001101756701245904, -0.01914376951754093, 0.0295212771743536, -0.024550998583436012, -0.0017392565496265888, -0.004260240122675896, 0.028674691915512085, 0.016590356826782227, -0.01994939334690571, -0.009025700390338898, 0.0038881516084074974, -0.016112444922327995, -0.006001203320920467, -0.0038028103299438953, -0.019744573161005974, -8.080758561845869e-05, -0.03828753903508186, 0.011442567221820354, 0.009558230638504028, 0.012521281838417053, 0.019990356639027596, 0.030804811045527458, 0.01608513668179512, 0.011845378205180168, -0.004881524946540594, -0.0023451801389455795, -0.012343771755695343, 0.008534134365618229, -0.03304416686296463, -0.027773486450314522, -0.004000802058726549, 0.04033573344349861, -0.003761846339330077, -0.008534134365618229, -0.03115983121097088, 0.009025700390338898, -0.03593894839286804, -0.027691559866070747, -0.006731725297868252, 0.02998553402721882, 0.019689954817295074, 0.044650591909885406, -0.00567690609022975, 0.04560641571879387, 0.01547067891806364, -0.0023281117901206017, -0.0197172649204731, -0.008063049986958504, -0.009933732450008392, 0.020673086866736412, 0.020468268543481827, 0.005680319853127003, -0.026380715891718864, 0.004605018999427557, 0.00763292983174324, 0.0010556724155321717, 0.02149236388504505, 0.011852205730974674, -0.016126099973917007, -0.013436141423881054, -0.0009763049893081188, -0.0010915157618001103, 0.013422486372292042, 0.02635340765118599, -1.2094468729628716e-05, -0.062483519315719604, -0.010138551704585552, 0.004929316230118275, -0.0032515053171664476, -0.019635336473584175, 0.014460237696766853, -0.003676505060866475, -0.029275495558977127, 0.011715659871697426, -0.011647386476397514, -0.00968112237751484, 0.010261443443596363, -0.022789552807807922, 0.047873079776763916, 0.0008401855593547225, -0.0066566248424351215, 0.010548190213739872, 0.016153410077095032, -0.0334538072347641, -0.028319671750068665, 0.012309635058045387, 0.006404014304280281, 0.029029712080955505, 0.0026302202604711056, -0.02366344816982746, -0.003987147472798824, -0.005455018486827612, 0.009203210473060608, -0.01350441388785839, -0.01989477500319481, -0.0021113448310643435, 0.0073257009498775005, -0.0375501923263073, 0.01411887165158987, 0.02599838748574257, 0.0021369473543018103, -0.0014448289293795824, -0.02030441164970398, -0.018624894320964813, 0.0027923688758164644, -0.016685940325260162, 0.0015497987624257803, -0.016303610056638718, 0.013306422159075737, 0.02042730338871479, -0.028483526781201363, -0.03465541452169418, -0.01280120201408863, -0.0018007023027166724, 0.016303610056638718, 0.004577709827572107, 0.22393569350242615, -0.002807730110362172, -0.013231322169303894, 0.014624092727899551, -0.0037208825815469027, 0.00778995780274272, 0.030914047732949257, 0.004062247928231955, -0.0196626465767622, 0.005069275852292776, 0.016522083431482315, 0.010002005845308304, -0.014842566102743149, 0.010548190213739872, -0.00755782937631011, -0.013449795544147491, -0.0433124378323555, 0.010677908547222614, -0.012930920347571373, 0.005079516675323248, 0.011367467232048512, -0.031132522970438004, -0.01065742690116167, -0.003488754155114293, 0.021970275789499283, -0.0009037648560479283, 0.003483633743599057, 0.001224648323841393, 0.02037268504500389, 0.0054208822548389435, -0.033317260444164276, -0.009455820545554161, 0.001173443510197103, -0.006294777616858482, -0.022052202373743057, -0.00320712779648602, 0.02987629733979702, -0.03369959071278572, -0.014542165212333202, 0.020741360262036324, 0.007994777522981167, -0.0334538072347641, -0.005912448279559612, -0.008991563692688942, -0.001124798902310431, 0.00962650403380394, -0.013722888194024563, 0.013258631341159344, -0.00778995780274272, -0.01209116168320179, -0.0078104399144649506, -0.0017307224916294217, 0.03140561282634735, 0.016481120139360428, -0.0011060237884521484, -0.022502806037664413, 0.010131724178791046, 0.0007002257043495774, 0.011456222273409367, 0.02818312495946884, -0.024537343531847, 0.03399999067187309, -0.03421846404671669, 0.025684330612421036, -0.00016300196875818074, 0.023267464712262154, 0.01514296792447567, -0.01452851016074419, -0.00415100296959281, -0.015416060574352741, -0.02348593808710575, -0.003493874566629529, -0.0123232901096344, -0.00898473709821701, -0.022625697776675224, -0.003123493166640401, 0.006165058817714453, 0.019594373181462288, 0.01596224494278431, -0.004881524946540594, 0.00358775001950562, 0.011838551610708237, 0.017996782436966896, 0.007414455991238356, -0.006390359718352556, -0.0011137045221403241, -0.0023793166037648916, -0.011777105741202831, -0.012821683660149574, 
0.01854296773672104, -0.0010036141611635685, -0.0043558222241699696, 0.0019577303901314735, 0.00503513915464282, -0.01162690483033657, -0.011367467232048512, 0.012309635058045387, 0.0011341865174472332, 0.007155018392950296, -0.013893570750951767, -0.01784658245742321, 0.023144572973251343, 0.014651401899755001, -0.018160637468099594, -0.01802409254014492, 0.015689153224229813, -0.020154211670160294, 0.02001766487956047, 0.012521281838417053, -0.024578306823968887, 0.009134937077760696, -0.03834215924143791, -0.00179387500975281, -0.005038552917540073, 0.010309234261512756, -0.0023025094997137785, 0.019348589703440666, 0.023444974794983864, -0.0027104411274194717, 0.004908834118396044, -0.0019116461044177413, -0.00778995780274272, 0.0004936996847391129, -0.012043370865285397, 0.025506820529699326, -0.028401600196957588, -0.012671482749283314, 0.010568671859800816, -0.01930762641131878, -0.011189957149326801, 0.008288350887596607, -0.016276301816105843, 0.0158393532037735, -0.005069275852292776, -0.010384335182607174, 0.00748272892087698, -0.0002297815663041547, -0.04115501046180725, 0.01624899171292782, 0.0029152603819966316, 0.018583931028842926, -0.011811242438852787, 0.009435338899493217, 0.009674294851720333, 0.018242565914988518, -0.013736542314291, 0.019471481442451477, -0.004495781846344471, -0.014282727614045143, -0.0015788148157298565, -0.02900240197777748, 0.012391563504934311, -0.011381121352314949, -0.0088618453592062, 0.0014926200965419412, -0.023144572973251343, -0.012814856134355068, -0.04568834230303764, 0.004908834118396044, 0.016576701775193214, -0.02916625700891018, 0.0015762546099722385, 0.007844576612114906, 0.017163850367069244, -0.007523692678660154, -0.009599193930625916, -0.17445136606693268, 0.015511643141508102, 0.026722081005573273, -0.024510033428668976, 0.0266401544213295, 0.009353411383926868, 0.03315340355038643, -0.002693372778594494, -0.016153410077095032, 0.009530921466648579, -0.022625697776675224, 0.007373492233455181, -0.027227303013205528, -0.009046182036399841, 0.009646985679864883, -0.0019491963321343064, -0.006588351912796497, 0.01749156229197979, -0.003908633720129728, 0.0246465802192688, 0.020413650199770927, -0.018857022747397423, -0.005554014816880226, 0.0197172649204731, -0.024032123386859894, -0.0021488950587809086, -0.007817267440259457, -0.002867469098418951, 0.004686946514993906, -0.03509236127138138, -0.03099597617983818, -0.013381523080170155, 0.006188954226672649, -0.01132650300860405, 0.0028742963913828135, -0.01825622096657753, -0.0008645078050903976, 0.00572469737380743, -0.0038403605576604605, 0.024223286658525467, 0.013750197365880013, 0.01499276701360941, 0.007339355535805225, 0.004379717633128166, 0.010705218650400639, 0.009585539810359478, 0.015812044963240623, -0.0074076284654438496, 0.008725298568606377, -0.03211565315723419, 0.03610280156135559, -0.025438547134399414, 0.007161845453083515, -0.017109232023358345, 0.015074695460498333, 0.013832124881446362, 0.008704816922545433, 0.029712442308664322, 0.018160637468099594, -0.018816059455275536, 0.011640558950603008, -0.020823288708925247, 0.00651666522026062, -0.009251001290977001, 0.02231164090335369, -0.011517668142914772, -0.020345376804471016, 0.023349391296505928, -0.01597589999437332, 0.016481120139360428, -0.01185903325676918, -0.01517027709633112, -0.00138679682277143, -0.009162246249616146, 0.0005777609185315669, 0.010343370959162712, -0.008964254520833492, 
-0.012487145140767097, 0.027145374566316605, -0.007059435825794935, -0.006219677161425352, 0.051450587809085846, -0.019266661256551743, 0.012794374488294125, -0.011053411290049553, -0.0012579314643517137, -0.006987749133259058, 0.01902087964117527, -0.01678152196109295, 0.010548190213739872, -0.01608513668179512, -0.0034955814480781555, -0.01499276701360941, -0.0030398587696254253, -5.2378250984475017e-05, 0.030804811045527458, 0.0025551198050379753, -0.021929312497377396, 0.01953975483775139, -0.019812846556305885, 0.01608513668179512, 0.01429638173431158, -0.016890758648514748, 0.0007663652650080621, 0.018242565914988518, -0.0001043831289280206, 0.011224093846976757, 0.0158393532037735, 0.012125298380851746, -0.008179114200174809, 0.022270677611231804, -0.0006157378084026277, 0.009899595752358437, 0.012521281838417053, 0.006083130836486816, 0.018870677798986435, -0.021683529019355774, -0.01631726510822773, -0.0029920674860477448, 0.012405217625200748, 0.043175891041755676, 0.013832124881446362, -0.0035672681406140327, 0.02500160038471222, -0.009489957243204117, -0.02519276551902294, -0.10093491524457932, -0.020031319931149483, 0.01534778717905283, 0.02881123684346676, -0.014596783556044102, -0.0034238947555422783, -0.00034456566208973527, 0.016344573348760605, -0.012391563504934311, 0.010418470948934555, 0.015511643141508102, -0.004990761633962393, -0.02094617858529091, 0.008977909572422504, 0.02377268485724926, -0.024195978417992592, 0.01930762641131878, -0.018474694341421127, 0.007421283051371574, 0.036840151995420456, -0.002529517514631152, -0.017641762271523476, 0.006598592735826969, -0.0016786642372608185, -0.015156622976064682, -0.014009634964168072, -0.016918068751692772, 0.006622488144785166, 0.016767866909503937, 0.0051238941960036755, 0.0059875487349927425, -0.005140962544828653, -0.0157301165163517, -0.01411887165158987, -0.025452202185988426, 0.01252810936421156, -0.0032788144890218973, 0.0015899091958999634, 0.042165450751781464, -0.02371806651353836, -0.006151404231786728, 0.02384095825254917, -0.013852606527507305, -0.0004698041011579335, -0.0075373477302491665, -0.00021452680812217295, -0.05134135112166405, 0.022093167528510094, 0.00804256834089756, -0.0054174684919416904, -0.011442567221820354, -0.011162647977471352, -0.009401202201843262, -0.006069476250559092, 0.01684979535639286, 0.006147990468889475, -0.013046984560787678, 0.004178312141448259, -0.004178312141448259, -0.0014559233095496893, 0.0009515559650026262, -0.029958225786685944, -0.02014055661857128, 0.0264762993901968, 0.024537343531847, -0.02425059676170349, -0.018884332850575447, -0.0033641557674854994, 0.025452202185988426, -0.024346178397536278, -2.384223807894159e-05, 0.0006089105154387653, -0.01259638275951147, 0.01250080019235611, -0.02348593808710575, 0.006980922073125839, -0.010015659965574741, 0.0065678698010742664, 0.03875179588794708, 0.0019133529858663678, -0.01012489665299654, -0.0157301165163517, 0.021669873967766762, -0.010486744344234467, 0.037304408848285675, 0.009319274686276913, 0.03058633767068386, 0.01566184312105179, 0.003128613578155637, -0.03866986930370331, -0.005516464356333017, 0.0033556215930730104, 0.004611846059560776, -0.01015220582485199, -0.02694055624306202, 0.054618459194898605, 0.0005790410214103758, -0.015252204611897469, 0.020809633657336235, 0.01488353032618761, -0.01715019717812538, -0.005099998787045479, -0.06346665322780609, 0.0265309177339077, -0.01007027830928564, -0.014391964301466942, -0.0033505011815577745, -0.010848592035472393, 0.01065742690116167, -0.023690756410360336, 0.006475700996816158, 0.000753137341234833, -0.00453333230689168, 0.030504409223794937, -0.0019184733973816037, -0.014269072562456131, -0.01919838786125183, -0.011824896559119225, -0.010732527822256088, -0.01282851118594408, 0.009489957243204117, -0.012493972666561604, -0.01994939334690571, 0.013408832252025604, -0.00557449646294117, -0.011080720461905003, -0.020741360262036324, -0.0022222886327654123, 0.006182127166539431, 0.011702004820108414, -0.011968269944190979, 0.006830721162259579, 0.01820160262286663, -0.034546177834272385, -0.01411887165158987, 0.02870200015604496, 0.005557428114116192, -0.01168152317404747, -0.01814698427915573, -0.002768473234027624, 0.01409156247973442, -0.0011888049775734544, -0.0031798183917999268, -0.02711806632578373, -0.00865702610462904, 0.00727790966629982, 0.012480318546295166, -0.011572286486625671, -0.007960640825331211, 0.006895580794662237, 0.020058630034327507, 0.02435983344912529, 0.0036969869397580624, 0.010630117729306221, 0.00042414647759869695, -0.03708593547344208, -0.027800796553492546, -0.016590356826782227, 0.018979914486408234, -0.02147870883345604, -0.009940559975802898, -0.014569474384188652, 0.018925296142697334, 0.013456623069941998, 0.019157424569129944, -0.0334538072347641, 0.005543773528188467, -0.005851002410054207, -0.0059807212091982365, -0.006581524387001991, -0.008773090317845345, -0.019976701587438583, 0.0039700791239738464, 0.018597586080431938, 0.0006622488144785166, 0.029685132205486298, -0.014419273473322392, 0.009763049893081188, 0.010425298474729061, 0.008827708661556244, -0.02870200015604496, -5.616527050733566e-05, -0.0017196281114593148, 0.0022171682212501764, -0.006482528522610664, 0.011265057139098644, 0.02765059471130371, 0.02395019493997097, -0.0065678698010742664, 0.01073935441672802, -0.016167065128684044, -0.008732126094400883, -0.006492769345641136, 0.011278712190687656, -0.013538550585508347, 0.0045640552416443825, 0.0157847348600626, 0.024728508666157722, -0.026339752599596977, 0.0020737946033477783, 0.013784334063529968, 0.01930762641131878, -0.012357426807284355, -0.006926303263753653, -0.0023741961922496557, -0.01285582035779953, -0.0004000375629402697, 0.007830921560525894, 0.00132364418823272, -0.03785059228539467, -0.019744573161005974, 0.005151203367859125, 0.019580718129873276, 0.024510033428668976, 0.003795983036980033, -0.0050180708058178425, -0.015443369746208191, -0.0032310232054442167, -0.0017494976054877043, -0.024086741730570793, -0.01637188345193863, 0.02371806651353836, 0.014596783556044102, 0.030012844130396843, -0.027036137878894806, -0.01282851118594408, 0.02135581709444523, 0.002705320715904236, 0.015443369746208191, -0.01467871107161045, 0.010800800286233425, -0.016467465087771416, -0.00850682519376278, 0.019471481442451477, -0.044869065284729004, -0.010698391124606133, -0.019676299765706062, -0.013408832252025604, 
0.0014320277841761708, 0.03162408992648125, -0.020167866721749306, 0.07471805065870285, -0.00374136446043849, -0.016098791733384132, 0.018652204424142838, -0.00927148386836052, 0.03105059452354908, 0.0037242963444441557, -0.011565458960831165, 0.008998391218483448, -0.027473084628582, 0.0017298690509051085, 0.016535738483071327, -0.0032429711427539587, 0.014596783556044102, -0.012814856134355068, -0.0009524094057269394, 0.035065051168203354, 0.02024979330599308, 0.006492769345641136, -0.03569316491484642, 0.021110035479068756, -0.018734131008386612, 0.021574292331933975, 0.025793567299842834, -0.030094770714640617, -0.023786339908838272, 0.014542165212333202, 0.011606423184275627, 0.0065746973268687725, -0.0354473814368248, -0.003519477089866996, -0.011408430524170399, -0.024373488500714302, -0.028073888272047043, -0.02231164090335369, 0.000954116228967905, -0.006229917984455824, -0.0018723891116678715, 0.0015745478449389338, 0.02235260419547558, -0.005458432249724865, 0.026312442496418953, -0.0014004514086991549, -0.013012847863137722, 0.020509231835603714, 0.0274184662848711, 0.0039700791239738464, 0.017095578834414482, -0.017873890697956085]""",
        "content": """At the end of each long \nrest, you can magically produce 40 rounds of \nammunition with this magazine. After each short \nrest, you can produce 10 rounds. 
If you lose your Arcane Magazine, you can \ncreate a new one as part of a long rest, using 25 \ngp of leather and other raw materials. Thunder Monger \nAt 3rd level, you learn to channel thunder energy \ninto your Thunder 
Cannon. As an action, you can \nmake a special attack with your Thunder Cannon \nthat deals an extra 1d6 thunder damage on a hit. This extra damage increases by 1d6 when you \nreach certain levels in this class: 5th level 
(2d6), \n7th level (3d6), 9th level (4d6), 11th level (5d6), \n13th level (6d6), 15th level (7d6), 17th level \n(8d6), and 19th level (9d6). Blast Wave \nStarting at 9th level, you can channel force \nenergy into your Thunder Cannon. As an action, \nyou can make a special attack with it. Rather \nthan making an attack roll, you unleash force \nenergy in a 15-foot cone from the gun. Each \ncreature in that area must make a Strength \nsaving 
throw with a DC of 8 + your proficiency \nbonus + your Intelligence modifier. On a failed \nsaving throw, a target takes 2d6 force damage \nand is pushed 10 feet away from you. This damage increases by 1d6 when you reach \ncertain levels in this class: 13th level (3d6) and \n17th level (4d6). Piercing Round \nStarting at 14th level, you can shoot lightning \nenergy through your Thunder Cannon. As an \naction, you can make a special attack with it. Rather than making an attack roll, you cause the \ngun to unleash a bolt of lightning, 5-feet wide \nand 30-feet long. Each creature in that area must \nmake Dexterity saving throws with a DC of 8 + \nyour proficiency bonus + your Intelligence \nmodifier. On a failed saving throw, a target takes \nÂ©2017 Wizards of the Coast LLC \n7 \n4d6 lightning damage. This damage increases to \n6d6 when you reach 19th level in this class. Explosive Round \nStarting at 17th level, you can channel fiery \nenergy into your Thunder Cannon. """,
        "pageNumber": 666,
    }

query = text("""
INSERT INTO sourcebook_embedings (sourcebook_hash, vector, content, page_number)
VALUES (:sourcebook_hash, :vector, :content, :page_number)
""")


# Use a dictionary to pass parameters to avoid SQL injection and ensure proper type handling
params = {
    "sourcebook_hash": vectorData["sourcebookHash"],
    "vector": vectorData["vector"],
    "content": vectorData["content"],
    "page_number": vectorData["pageNumber"],
}

DATABASE_URL = os.getenv("DATABASE_URL")

engine = create_engine(
    DATABASE_URL
)

with engine.connect() as con:
    print("Inserting vector data into the database")
    con.execute(query, params)
    con.commit()
    print("Vector data inserted successfully")